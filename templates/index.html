<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö OMR</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/shared.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Mobile-only Welcome Screen -->
    <div id="mobile-welcome" class="mobile-only">
        <div class="welcome-box">
            <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û OMR</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</p>
            <a href="/capture" class="btn btn-primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û</a>
        </div>
    </div>

    <div class="main-container desktop-only">
        <header class="main-header">
            <div class="header-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö OMR</div>
            <div class="header-controls">
                <div class="session-status-header">
                    <div class="session-info-header">
                        <span class="session-label">üîó Session:</span>
                        <span id="session-id-display-header">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                    </div>
                    <div class="server-info-header">
                        <span class="server-label">üåê Server:</span>
                        <span id="server-ip-display-header">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                    </div>
                </div>
                <div class="header-actions-main">
                    <button id="show-qr-btn-header" class="btn-sm btn-info">üì± ‡πÅ‡∏™‡∏î‡∏á QR Code</button>
                    <button id="copy-mobile-link-btn-header" class="btn-sm btn-outline">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
                </div>
            </div>
        </header>

        <div class="dashboard-grid">
            <!-- LEFT PANEL (SHARED) -->
            <div class="panel-left">
                <!-- TOP-LEFT: Image Preview (SHARED) -->
                <div class="panel-box">
                    <div class="panel-header-vertical">
                        <h3>‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (<span id="image-count">0</span>)</h3>
                        <div class="header-actions-horizontal">
                            <button id="optimize-images-btn" class="btn-sm btn-info" disabled>üöÄ ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ß‡πá‡∏ö</button>
                            <button id="clean-selected-btn" class="btn-sm btn-secondary" disabled>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á</button>
                            <button id="delete-selected-btn" class="btn-sm btn-danger" disabled>‡∏•‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                            <button id="delete-all-btn" class="btn-sm btn-danger" disabled>‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        </div>
                    </div>

                    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå -->
                    <div class="upload-section">
                        <label for="pc-upload-input" class="btn btn-secondary">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û/PDF)</label>
                        <input type="file" id="pc-upload-input" accept="image/*,.pdf" multiple hidden>
                    </div>

                    <div id="image-preview-container">
                        <div id="image-preview-grid"></div>
                        <div class="upload-placeholder" id="upload-placeholder">
                            <p>üìÅ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏°‡∏≤‡∏ß‡∏≤‡∏á (‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û/PDF)</p>
                        </div>
                    </div>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô) -->
                <div class="panel-box">
                    <div class="panel-header">
                        <h3>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (.csv)</h3>
                    </div>
                    <div class="control-section">
                        <div class="file-group">
                            <label for="student-list-input" id="student-list-label"
                                class="btn btn-label btn-secondary">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                            <input type="file" id="student-list-input" accept=".csv" hidden>
                            <button id="view-student-list-btn" class="btn btn-sm btn-outline"
                                style="display: none; margin-top: 8px;">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>
                        </div>
                    </div>
                </div>

                <!-- BOTTOM-LEFT: Main Controls with Tabs -->
                <div class="panel-box" id="controls-container">
                    <!-- TABS NAVIGATION -->
                    <div class="tabs">
                        <button class="tab-link active" data-tab="single-answer-tab">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö 1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                        <button class="tab-link" data-tab="multi-answer-tab">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                    </div>

                    <!-- TAB CONTENT -->
                    <div class="tab-content">
                        <!-- SINGLE ANSWER TAB PANE -->
                        <div id="single-answer-tab" class="tab-pane active">
                            <div class="panel-header" style="margin-top:16px;">
                                <h3>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
                            </div>
                            <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏â‡∏•‡∏¢ -->
                            <div class="control-section">
                                <div class="file-group">
                                    <label for="answer-key-input-single" id="answer-key-label-single"
                                        class="btn btn-label btn-secondary">‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏â‡∏•‡∏¢ 1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (.csv)</label>
                                    <input type="file" id="answer-key-input-single" accept=".csv" required hidden>
                                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                                        <button id="view-answer-key-btn-single" class="btn btn-sm btn-outline"
                                            style="display: none; width: 100%;">‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏â‡∏•‡∏¢</button>
                                        <button id="create-edit-answer-key-btn-single" class="btn btn-sm btn-secondary"
                                            style="width: 100%;">‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏â‡∏•‡∏¢</button>
                                    </div>
                                </div>
                            </div>

                            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• -->
                            <div class="control-section">
                                <button id="process-btn-single" class="btn btn-primary" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (1
                                    ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</button>
                            </div>

                        </div>

                        <!-- MULTIPLE ANSWER TAB PANE -->
                        <div id="multi-answer-tab" class="tab-pane">
                            <div class="panel-header" style="margin-top:16px;">
                                <h3>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
                            </div>

                            <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏â‡∏•‡∏¢ -->
                            <div class="control-section">
                                <div class="file-group">
                                    <label for="answer-key-input-multi" id="answer-key-label-multi"
                                        class="btn btn-label btn-secondary">‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏â‡∏•‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (.csv)</label>
                                    <input type="file" id="answer-key-input-multi" accept=".csv" required hidden>
                                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                                        <button id="view-answer-key-btn-multi" class="btn btn-sm btn-outline"
                                            style="display: none; width: 100%;">‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏â‡∏•‡∏¢</button>
                                        <button id="create-edit-answer-key-btn-multi" class="btn btn-sm btn-secondary"
                                            style="width: 100%;">‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏â‡∏•‡∏¢</button>
                                    </div>
                                </div>
                            </div>
                            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• -->
                            <div class="control-section">
                                <button id="process-btn-multi" class="btn btn-primary" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
                                    (‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</button>
                            </div>


                        </div>
                    </div>


                </div>

                <!-- Export CSV Section -->
                <div class="panel-box">
                    <div class="panel-header">
                        <h3>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (.csv)</h3>
                    </div>
                    <div class="export-tabs">
                        <div class="export-tab" id="export-single-tab">
                            <h4>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å 1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h4>
                            <input type="text" id="output-filename-single" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå"
                                value="single_answer_results">
                            <button id="download-csv-btn-single" class="btn btn-success"
                                style="display: none; margin-top:8px;">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
                        </div>
                        <div class="export-tab" id="export-multi-tab">
                            <h4>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h4>
                            <input type="text" id="output-filename-multi" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå"
                                value="multi_answer_results">
                            <button id="download-csv-btn-multi" class="btn btn-success"
                                style="display: none; margin-top:8px;">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
                        </div>
                    </div>
                </div>

                <!-- Tools Section -->
                <div class="panel-box">
                    <div class="panel-header">
                        <h3>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h3>
                    </div>
                    <div class="control-section">
                        <a href="/download_template" class="btn btn-secondary">üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö PDF</a>
                        <a href="/manual" class="btn btn-secondary" style="margin-top: 8px;">üìö ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a>
                        <button id="new-session-btn" class="btn btn-danger" style="margin-top: 8px;"
                            disabled>‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)</button>
                    </div>
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏â‡∏•‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ö‡∏ö dynamic ‡∏î‡πâ‡∏ß‡∏¢ JS) -->
                    <div id="download-files-section" class="download-section"></div>
                </div>
            </div>

            <!-- RIGHT PANEL (Results area changes based on tab) -->
            <div class="panel-box">
                <!-- SINGLE ANSWER RESULTS -->
                <div id="results-panel-single" class="results-panel active">
                    <div class="panel-header">
                        <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à (1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
                        <div class="header-actions">
                            <button id="clear-results-btn-single" class="btn-sm btn-secondary"
                                style="display: none;">‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
                        </div>
                    </div>
                    <div id="results-area-single" class="results-area-content">
                        <div class="loading-spinner" id="loading-spinner-single" style="display: none;">
                            <div class="spinner"></div>
                            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
                        </div>
                        <div class="results-placeholder" id="results-placeholder-single">
                            <p>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                        </div>
                        <div class="table-container">
                            <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ -->
                            <div id="unmatched-section-single" style="display: none;">
                                <h4 style="color: #ef4444; margin-bottom: 10px;">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ</h4>
                                <table id="unmatched-table-single">
                                    <thead>
                                        <tr>
                                            <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                            <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                            <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="unmatched-tbody-single"></tbody>
                                </table>
                            </div>

                            <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ -->
                            <div id="matched-section-single" style="display: none;">
                                <h4 style="color: #10b981; margin-bottom: 10px;">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ</h4>
                                <table id="results-table-single">
                                    <thead>
                                        <tr>
                                            <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                            <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                            <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="results-tbody-single"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MULTI ANSWER RESULTS -->
                <div id="results-panel-multi" class="results-panel">
                    <div class="panel-header">
                        <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à (‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
                        <div class="header-actions">
                            <button id="clear-results-btn-multi" class="btn-sm btn-secondary"
                                style="display: none;">‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
                        </div>
                    </div>
                    <div id="results-area-multi" class="results-area-content">
                        <div class="loading-spinner" id="loading-spinner-multi" style="display: none;">
                            <div class="spinner"></div>
                            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
                        </div>
                        <div class="results-placeholder" id="results-placeholder-multi" style="display: flex;">
                            <p>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                        </div>
                        <div class="table-container">
                            <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ -->
                            <div id="unmatched-section-multi" style="display: none;">
                                <h4 style="color: #ef4444; margin-bottom: 10px;">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ</h4>
                                <table id="unmatched-table-multi">
                                    <thead>
                                        <tr>
                                            <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                            <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                            <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="unmatched-tbody-multi"></tbody>
                                </table>
                            </div>

                            <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ -->
                            <div id="matched-section-multi" style="display: none;">
                                <h4 style="color: #10b981; margin-bottom: 10px;">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ</h4>
                                <table id="results-table-multi">
                                    <thead>
                                        <tr>
                                            <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                            <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                            <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="results-tbody-multi"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Modals (SHARED) -->
    <!-- Image Modal -->
    <div id="image-modal" class="modal">
        <span class="modal-close">&times;</span>
        <div class="modal-content"> <img id="modal-img" alt="modal-img" src=""> </div>
        <div class="zoom-info">
            <p><strong>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong></p>
            <p>üñ±Ô∏è ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡πâ‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå: ‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å</p>
            <p>üñ±Ô∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏≤‡∏Å: ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
        </div>
    </div>
    <!-- Answer Key & Student List View Modals -->
    <div id="data-view-modal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content-dialog">
                <div class="modal-header">
                    <h3 id="data-view-modal-title">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <span class="modal-close" id="data-view-close">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="data-view-content">
                        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Manual Answer Key Edit Modal -->
    <div id="manual-answer-key-modal" class="modal">
        <div class="modal-dialog" style="max-width: 95vw; width: fit-content; margin: 1% auto;">
            <div class="modal-content-dialog">
                <div class="modal-header">
                    <h3 id="manual-answer-key-modal-title">‡∏™‡∏£‡πâ‡∏≤‡∏á / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏â‡∏•‡∏¢</h3>
                    <span class="modal-close" id="manual-answer-key-close">&times;</span>
                </div>
                <div class="modal-body" id="manual-answer-key-body">
                    <div id="manual-answer-key-content">
                        <!-- Content generated by JS -->
                    </div>
                </div>
                <div class="modal-footer"
                    style="display: flex; justify-content: flex-end; padding: 16px; border-top: 1px solid var(--border-color);">
                    <button id="clear-manual-answer-key-btn" class="btn btn-secondary"
                        style="margin-right: 8px;">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button id="save-manual-answer-key-btn" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏•‡∏¢</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Score Edit Modal -->
    <div id="score-edit-modal" class="modal">
        <div class="modal-dialog" style="max-width: 95vw; width: 90vw; margin: 2% auto;">
            <div class="modal-content-dialog">
                <div class="modal-header">
                    <h3 id="score-edit-modal-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                    <span class="modal-close" id="score-edit-close">&times;</span>
                </div>
                <div class="modal-body" style="padding: 0;">
                    <div class="score-edit-container">
                        <!-- Left Panel: Highlighted Image -->
                        <div class="score-edit-panel score-edit-image">
                            <div class="panel-header">
                                <h4>‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå</h4>
                                <button id="view-large-image-btn" class="btn-sm btn-info" style="margin-left: auto;" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ã‡∏π‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏û‡∏ô">
                                    üîç ‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà
                                </button>
                            </div>
                            <div class="image-container">
                                <img id="score-edit-highlighted-image" src="" alt="Highlighted Answer Sheet">
                            </div>
                        </div>

                        <!-- Middle Panel: Answer Form -->
                        <div class="score-edit-panel score-edit-form">
                            <div class="panel-header">
                                <h4>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h4>
                            </div>
                            <div class="student-info">
                                <span id="score-edit-student-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
                                <span id="score-edit-student-id">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
                            </div>
                            <div class="answers-form" id="score-edit-answers-form">
                                <!-- Dynamic content will be generated here -->
                            </div>
                        </div>

                        <!-- Right Panel: Answer Key -->
                        <div class="score-edit-panel score-edit-key">
                            <div class="panel-header">
                                <h4>‡πÄ‡∏â‡∏•‡∏¢</h4>
                            </div>
                            <div class="answer-key-display" id="score-edit-answer-key">
                                <!-- Answer key will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer"
                    style="display: flex; justify-content: space-between; padding: 16px; border-top: 1px solid var(--border-color);">
                    <div class="score-display">
                        <strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="current-score-display">0/0</span></strong>
                    </div>
                    <div class="footer-buttons">
                        <button id="cancel-score-edit-btn" class="btn btn-secondary"
                            style="margin-right: 8px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button id="save-score-edit-btn" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qr-modal" class="modal">
        <div class="modal-dialog qr-modal-dialog">
            <div class="modal-content-dialog">
                <div class="modal-header">
                    <h3>üì± ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</h3>
                    <span class="modal-close" id="qr-modal-close">&times;</span>
                </div>
                <div class="modal-body qr-modal-body">
                    <div class="qr-content-wrapper">
                        <!-- QR Code Section (Left) -->
                        <div class="qr-code-section">
                            <div id="qr-code-container" class="qr-container">
                                <div id="qr-loading" class="qr-loading">
                                    <div class="spinner"></div>
                                    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code...</p>
                                </div>
                                <canvas id="qr-canvas" class="qr-canvas"></canvas>
                            </div>
                        </div>

                        <!-- Instructions Section (Right) -->
                        <div class="qr-instructions">
                            <h4>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</h4>
                            <ol>
                                <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</li>
                                <li>‡∏ä‡∏µ‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà QR Code</li>
                                <li>‡πÅ‡∏ï‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏Ç‡∏∂‡πâ‡∏ô</li>
                                <li>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</li>
                            </ol>
                            <div class="qr-tip">
                                <p>
                                    üí° <strong>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:</strong> QR Code ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                                    ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer qr-modal-footer">
                    <button id="refresh-qr-btn" class="btn btn-secondary">üîÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    <button id="close-qr-btn" class="btn btn-primary">‡∏õ‡∏¥‡∏î</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Score Edit Modal -->
    <div id="score-edit-modal" class="modal score-edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
                <span id="score-edit-close" class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="score-edit-layout">
                    <!-- Left: Student Info & Image -->
                    <div class="score-edit-left">
                        <div class="score-edit-info">
                            <div class="student-info-row">
                                <label>‡∏ä‡∏∑‡πà‡∏≠:</label>
                                <span id="score-edit-student-name">-</span>
                                <small id="name-status-indicator" style="margin-left: 10px; font-style: italic; color: #6b7280;"></small>
                            </div>
                            <div class="student-info-row">
                                <label>‡∏£‡∏´‡∏±‡∏™:</label>
                                <span id="score-edit-student-id">-</span>
                                <button id="update-student-name-btn" class="btn-sm btn-secondary" style="margin-left: 10px; display: none;">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠</button>
                            </div>
                            <div class="student-info-row">
                                <label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</label>
                                <span id="current-score-display">-/-</span>
                            </div>
                            <div class="update-instructions" style="margin-top: 10px; padding: 8px; background: #f0f9ff; border-radius: 4px; font-size: 13px; color: #1e40af;">
                                üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å dropdown ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
                            </div>
                        </div>
                        <div class="score-edit-image-container">
                            <img id="score-edit-highlighted-image" src="" alt="Student Answer Sheet">
                            <div class="magnifier-lens"></div>
                        </div>
                    </div>
                    
                    <!-- Right: Answer Form & Answer Key -->
                    <div class="score-edit-right">
                        <div class="score-edit-answers">
                            <h4>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h4>
                            <div id="score-edit-answers-form"></div>
                        </div>
                        <div class="score-edit-answer-key">
                            <h4>‡πÄ‡∏â‡∏•‡∏¢</h4>
                            <div id="score-edit-answer-key"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-score-edit-btn" class="btn btn-secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="save-score-edit-btn" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>